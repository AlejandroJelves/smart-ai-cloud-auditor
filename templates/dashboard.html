<!DOCTYPE html>
<html>
<head>
  <title>CloudLens AI Dashboard</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #d8d8d8; font-family: monospace; }
    .sidebar { width:220px; min-height:100vh; background:#212529; color:white; position:fixed; top:0; left:0; padding:20px; }
    .sidebar h4 { text-align:center; margin-bottom:30px; }
    .sidebar a { display:block; padding:10px; margin-bottom:15px; color:white; text-decoration:none; border-radius:5px; }
    .sidebar a:hover { background:#343a40; }
    .content { margin-left:240px; padding:20px; }

    .card { 
      padding: 16px !important; 
      min-height: 145px; 
      display:flex; 
      flex-direction:column; 
      justify-content:center; 
      align-items:center; 
      overflow: hidden; 
    }

    .metric-title { font-size: 14px; color: #000; }
    .metric-value { font-size: 36px; font-weight:700; line-height:1.1; color:#000; }
    .metric-sub { font-size: 14px; color:#000; }
    .metric-fixed { font-variant-numeric: tabular-nums; }

    canvas { max-height: 270px !important; }

    /* Floating Chat */
    #chatBubble { position:fixed; bottom:20px; right:20px; background:#000000; color:white; border-radius:50%; width:60px; height:60px;
      display:flex; align-items:center; justify-content:center; font-size:24px; cursor:pointer; box-shadow:0 4px 6px rgba(0,0,0,0.2); z-index:1000; }
    #chatWindow { position:fixed; bottom:90px; right:20px; width:320px; height:420px; background:white; border:1px solid #ccc; border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.3); display:none; flex-direction:column; z-index:1000; }
    #chatHeader { background:#0d6efd; color:white; padding:10px; border-radius:10px 10px 0 0; }
    #chatBox { flex:1; overflow-y:auto; padding:10px; font-size:14px; background:#f8f9fa; }
    .user-msg { text-align:right; background:#e9f5ff; padding:6px 10px; border-radius:12px; display:inline-block; margin:4px 0; }
    .bot-msg { text-align:left; background:#e6f4ea; padding:6px 10px; border-radius:12px; display:inline-block; margin:4px 0; }
  </style>
</head>
<body>

<div class="sidebar">
  <h4>‚òÅÔ∏è CloudLens</h4>
  <a href="#" onclick="showView('overview')">Overview</a>
  <a href="#" onclick="showView('gcp')">Google Cloud</a>
  <a href="#" onclick="showView('aws')">AWS</a>
  <a href="#" onclick="showView('azure')">Azure</a>
</div>

<div class="content">
  <!-- ======= OVERVIEW ======= -->
  <div id="overview" class="view">
    <h3>Overview</h3>
    <div class="row text-center mt-3">
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Total Spend</div><div class="metric-value metric-fixed" id="totalSpend">$0</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Google Cloud</div><div class="metric-value metric-fixed" id="gcpSpend">$0</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">AWS</div><div class="metric-value metric-fixed" id="awsSpend">$0</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Azure</div><div class="metric-value metric-fixed" id="azureSpend">$0</div></div></div>
    </div>

    <div class="row mt-4">
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="metric-title">Spend by Provider</div>
          <canvas id="providerPie"></canvas>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="d-flex justify-content-between w-100">
            <div class="metric-title">Daily Cost Trend</div>
            <select id="overviewRange" class="form-select form-select-sm" style="width:150px;" onchange="updateOverviewChart()">
              <option value="7">Last 7 days</option>
              <option value="30">Last 30 days</option>
              <option value="90">Last 90 days</option>
              <option value="180">Last 6 months</option>
              <option value="365">Last Year</option>
            </select>
          </div>
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </div>

    <div class="card shadow-sm mt-4">
      <div class="metric-title">ü§ñ Quick AI Summary</div>
      <p id="overviewSummary">Loading insights...</p>
    </div>
  </div>

  <!-- ======= GCP ======= -->
  <div id="gcp" class="view" style="display:none;">
    <h3>Google Cloud</h3>
    <div class="row text-center mt-3">
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Total Spend</div><div class="metric-value" id="gcpTotal">$0</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Avg Daily Spend</div><div class="metric-value" id="gcpAvg">$0</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Budget Status</div><div class="metric-value" id="gcpBudget">-</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Idle Resources</div><div class="metric-value" id="gcpIdle">0</div></div></div>
    </div>
    <div class="row text-center mt-3">
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">CPU Usage</div><div class="metric-value" id="gcpCPU">-</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Traffic</div><div class="metric-value" id="gcpTraffic">-</div><div class="metric-sub">Mbps (in/out)</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Disk</div><div class="metric-value" id="gcpDisk">-</div><div class="metric-sub">MB/s (R/W)</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Logs (5m)</div><div class="metric-value" id="gcpLogs">-</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Requests</div><div class="metric-value" id="gcpRequests">-</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Latency</div><div class="metric-value" id="gcpLatency">-</div></div></div>
    </div>
    <div class="row mt-4"><div class="col-md-12"><div class="card shadow-sm"><div class="metric-title">Spend Trend</div><canvas id="gcpLine"></canvas></div></div></div>
    <div class="row mt-4">
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">Traffic (Mbps)</div><canvas id="gcpTrafficChart"></canvas></div></div>
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">CPU Utilization (%)</div><canvas id="gcpCpuChart"></canvas></div></div>
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">Error Logs (Daily)</div><canvas id="gcpLogsChart"></canvas></div></div>
    </div>
  </div>

  <!-- ======= AWS ======= -->
  <div id="aws" class="view" style="display:none;">
    <h3>AWS</h3>
    <div class="row text-center mt-3">
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Total Spend</div><div class="metric-value" id="awsTotal">$1,024</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Avg Daily Spend</div><div class="metric-value" id="awsAvg">$34</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Budget Status</div><div class="metric-value" id="awsBudget">‚úÖ Under</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Idle Resources</div><div class="metric-value" id="awsIdle">2</div></div></div>
    </div>
    <div class="row text-center mt-3">
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">CPU Usage</div><div class="metric-value" id="awsCPU">67%</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Traffic</div><div class="metric-value" id="awsTraffic">120/98</div><div class="metric-sub">Mbps</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Disk</div><div class="metric-value" id="awsDisk">14/21</div><div class="metric-sub">MB/s</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Logs</div><div class="metric-value" id="awsLogs">4</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Requests</div><div class="metric-value" id="awsRequests">984</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Latency</div><div class="metric-value" id="awsLatency">123ms</div></div></div>
    </div>
    <div class="row mt-4"><div class="col-md-12"><div class="card shadow-sm"><div class="metric-title">Spend Trend</div><canvas id="awsLine"></canvas></div></div></div>
    <div class="row mt-4">
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">Traffic (Mbps)</div><canvas id="awsTrafficChart"></canvas></div></div>
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">CPU Utilization (%)</div><canvas id="awsCpuChart"></canvas></div></div>
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">Error Logs (Daily)</div><canvas id="awsLogsChart"></canvas></div></div>
    </div>
  </div>

  <!-- ======= AZURE ======= -->
  <div id="azure" class="view" style="display:none;">
    <h3>Azure</h3>
    <div class="row text-center mt-3">
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Total Spend</div><div class="metric-value" id="azureTotal">$654</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Avg Daily Spend</div><div class="metric-value" id="azureAvg">$22</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Budget Status</div><div class="metric-value" id="azureBudget">‚ö†Ô∏è Over</div></div></div>
      <div class="col-md-3"><div class="card shadow-sm"><div class="metric-title">Idle Resources</div><div class="metric-value" id="azureIdle">5</div></div></div>
    </div>
    <div class="row text-center mt-3">
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">CPU Usage</div><div class="metric-value" id="azureCPU">54%</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Traffic</div><div class="metric-value" id="azureTraffic">89/101</div><div class="metric-sub">Mbps</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Disk</div><div class="metric-value" id="azureDisk">8/12</div><div class="metric-sub">MB/s</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Logs</div><div class="metric-value" id="azureLogs">6</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Requests</div><div class="metric-value" id="azureRequests">713</div></div></div>
      <div class="col-md-2"><div class="card shadow-sm"><div class="metric-title">Latency</div><div class="metric-value" id="azureLatency">87ms</div></div></div>
    </div>
    <div class="row mt-4"><div class="col-md-12"><div class="card shadow-sm"><div class="metric-title">Spend Trend</div><canvas id="azureLine"></canvas></div></div></div>
    <div class="row mt-4">
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">Traffic (Mbps)</div><canvas id="azureTrafficChart"></canvas></div></div>
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">CPU Utilization (%)</div><canvas id="azureCpuChart"></canvas></div></div>
      <div class="col-md-4"><div class="card shadow-sm"><div class="metric-title">Error Logs (Daily)</div><canvas id="azureLogsChart"></canvas></div></div>
    </div>
  </div>
</div>

<!-- Floating Chat -->
<div id="chatBubble">ñ¶π</div>
<div id="chatWindow">
  <div id="chatHeader">CloudLens Assistant</div>
  <div id="chatBox"></div>
  <div style="padding:10px; border-top:1px solid #ccc;">
    <input type="text" id="userInput" class="form-control form-control-sm" placeholder="Ask a question..." />
    <button class="btn btn-primary btn-sm mt-2 w-100" onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
/* ---- Colors ---- */
const PROVIDERS = {
  gcp:   { name: "Google Cloud", color: "#EB7C75" },
  aws:   { name: "AWS",          color: "#8CABFF" },
  azure: { name: "Azure",        color: "#FF8CB4" },
};
function normalizeDatasets(datasets) {
  const fallback = Object.values(PROVIDERS);
  return (datasets || []).map((ds, i) => {
    const key = (ds.id || ds.provider || ds.label || "").toString().toLowerCase().trim();
    const meta = PROVIDERS[key] || fallback[i % fallback.length];
    return { ...ds, label: ds.label || meta.name, borderColor: meta.color, backgroundColor: meta.color, tension:0.25, fill:false };
  });
}

/* ---- GCP (dummy 7-day charts) ---- */
function drawGcpCharts(){
  // Traffic
  new Chart(document.getElementById("gcpTrafficChart"), {
    type:"line",
    data:{ labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
      datasets:[
        { label:"Inbound", data:[120,130,125,140,150,160,155], borderColor:"#EB7C75", backgroundColor:"#EB7C7533", fill:true, tension:0.25 },
        { label:"Outbound", data:[95,100,105,110,120,118,122], borderColor:"#75A8EB", backgroundColor:"#75A8EB33", fill:true, tension:0.25 }
      ]},
    options:{ scales:{ y:{ beginAtZero:true } } }
  });

  // CPU
  new Chart(document.getElementById("gcpCpuChart"), {
    type:"line",
    data:{ labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
      datasets:[{ label:"CPU %", data:[65,70,72,68,75,80,77], borderColor:"#EB7C75", backgroundColor:"#EB7C7533", fill:true, tension:0.25 }]},
    options:{ scales:{ y:{ beginAtZero:true, max:100 } } }
  });

  // Logs
  new Chart(document.getElementById("gcpLogsChart"), {
    type:"bar",
    data:{ labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
      datasets:[{ label:"Errors", data:[3,5,2,6,4,7,5], backgroundColor:"#EB7C75" }]},
    options:{ scales:{ y:{ beginAtZero:true } } }
  });

  // Spend Trend
  new Chart(document.getElementById("gcpLine"), {
    type:"line",
    data:{ labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
      datasets:[{ label:"GCP Spend", data:[80,90,95,100,110,120,125], borderColor:"#EB7C75", backgroundColor:"#EB7C7533", fill:true, tension:0.25 }]},
    options:{ scales:{ y:{ beginAtZero:true } } }
  });
}

/* ---- AWS (dummy) ---- */
function drawAwsCharts(){
  new Chart(document.getElementById("awsTrafficChart"),{type:"line",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Traffic",data:[120,140,150,135,160,170,180],borderColor:"#8CABFF",backgroundColor:"#8CABFF33",fill:true,tension:0.25}]},options:{scales:{y:{beginAtZero:true}}}});
  new Chart(document.getElementById("awsCpuChart"),{type:"line",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"CPU %",data:[60,72,67,70,75,78,80],borderColor:"#8CABFF",backgroundColor:"#8CABFF33",fill:true,tension:0.25}]},options:{scales:{y:{beginAtZero:true,max:100}}}});
  new Chart(document.getElementById("awsLogsChart"),{type:"bar",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Errors",data:[2,5,4,6,3,7,5],backgroundColor:"#8CABFF"}]},options:{scales:{y:{beginAtZero:true}}}});
  new Chart(document.getElementById("awsLine"),{type:"line",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"AWS Spend",data:[120,140,130,125,150,160,170],borderColor:"#8CABFF",backgroundColor:"#8CABFF33",fill:true,tension:0.25}]},options:{scales:{y:{beginAtZero:true}}}});
}

/* ---- Azure (dummy) ---- */
function drawAzureCharts(){
  new Chart(document.getElementById("azureTrafficChart"),{type:"line",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Traffic",data:[89,95,101,97,105,110,115],borderColor:"#FF8CB4",backgroundColor:"#FF8CB433",fill:true,tension:0.25}]},options:{scales:{y:{beginAtZero:true}}}});
  new Chart(document.getElementById("azureCpuChart"),{type:"line",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"CPU %",data:[52,58,54,60,62,65,63],borderColor:"#FF8CB4",backgroundColor:"#FF8CB433",fill:true,tension:0.25}]},options:{scales:{y:{beginAtZero:true,max:100}}}});
  new Chart(document.getElementById("azureLogsChart"),{type:"bar",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Errors",data:[3,7,6,8,5,9,7],backgroundColor:"#FF8CB4"}]},options:{scales:{y:{beginAtZero:true}}}});
  new Chart(document.getElementById("azureLine"),{type:"line",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Azure Spend",data:[60,75,70,80,85,78,90],borderColor:"#FF8CB4",backgroundColor:"#FF8CB433",fill:true,tension:0.25}]},options:{scales:{y:{beginAtZero:true}}}});
}

/* ---- View toggler ---- */
function showView(id){
  document.querySelectorAll('.view').forEach(v=>v.style.display='none');
  document.getElementById(id).style.display='block';
  if(id==="gcp"){refreshTiles();drawGcpCharts();}
  if(id==="aws"){drawAwsCharts();}
  if(id==="azure"){drawAzureCharts();}
}
showView('overview');

/* ---- Overview tiles + pie ---- */
fetch("/api/costs").then(r => r.json()).then(data => {
  const gcp = data.filter(d => d.provider==="gcp");
  const aws = data.filter(d => d.provider==="aws");
  const azure = data.filter(d => d.provider==="azure");
  const sum = arr => arr.reduce((a,b)=>a+b.cost,0);
  const gcpTotal=sum(gcp), awsTotal=sum(aws), azureTotal=sum(azure);
  const total=gcpTotal+awsTotal+azureTotal;
  document.getElementById("totalSpend").innerText=`$${total.toFixed(2)}`;
  document.getElementById("gcpSpend").innerText=`$${gcpTotal.toFixed(2)}`;
  document.getElementById("awsSpend").innerText=`$${awsTotal.toFixed(2)}`;
  document.getElementById("azureSpend").innerText=`$${azureTotal.toFixed(2)}`;
  new Chart(document.getElementById("providerPie"), { type:"doughnut", data:{ labels:["GCP","AWS","Azure"], datasets:[{ data:[gcpTotal,awsTotal,azureTotal], backgroundColor:["#EB7C75","#8CABFF","#FF8CB4"]}] }});
  updateOverviewChart();
  fetch("/api/summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data})})
    .then(r=>r.json()).then(o => document.getElementById("overviewSummary").innerText = o.summary || "No summary.");
});
/* ---- Overview tiles + pie ---- */
fetch("/api/costs").then(r => r.json()).then(data => {
  const gcp = data.filter(d => d.provider==="gcp");
  const aws = data.filter(d => d.provider==="aws");
  const azure = data.filter(d => d.provider==="azure");
  const sum = arr => arr.reduce((a,b)=>a+b.cost,0);
  const gcpTotal=sum(gcp), awsTotal=sum(aws), azureTotal=sum(azure);
  const total=gcpTotal+awsTotal+azureTotal;
  document.getElementById("totalSpend").innerText=`$${total.toFixed(2)}`;
  document.getElementById("gcpSpend").innerText=`$${gcpTotal.toFixed(2)}`;
  document.getElementById("awsSpend").innerText=`$${awsTotal.toFixed(2)}`;
  document.getElementById("azureSpend").innerText=`$${azureTotal.toFixed(2)}`;
  new Chart(document.getElementById("providerPie"), { type:"doughnut", data:{ labels:["GCP","AWS","Azure"], datasets:[{ data:[gcpTotal,awsTotal,azureTotal], backgroundColor:["#EB7C75","#8CABFF","#FF8CB4"]}] }});
  updateOverviewChart();
  fetch("/api/summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data})})
    .then(r=>r.json()).then(o => document.getElementById("overviewSummary").innerText = o.summary || "No summary.");
});

/* ---- Overview trend line ---- */
let trendChart;
function updateOverviewChart(){
  const range = document.getElementById("overviewRange").value;
  fetch(`/api/costs?range=${range}`).then(r => r.json()).then(data => {
    trendChart && trendChart.destroy();
    const datasets = normalizeDatasets(data.datasets);
    trendChart = new Chart(document.getElementById("trendChart"), { type:"line", data:{ labels:data.labels, datasets }, options:{ scales:{y:{beginAtZero:true}}}});
  });
}

/* ===== GCP KPI tiles (still fetch real API if available) ===== */
function refreshTiles(){
  fetch("/api/tiles")
    .then(r=>r.json())
    .then(t=>{
      document.getElementById("gcpCPU").innerText = `${(t.cpu_percent ?? 0).toFixed(1)}%`;
      document.getElementById("gcpTraffic").innerText = `${(t.traffic?.mbps_in || 0).toFixed(2)} / ${(t.traffic?.mbps_out||0).toFixed(2)}`;
      document.getElementById("gcpDisk").innerText = `${(t.disk?.read_mbs || 0).toFixed(2)} / ${(t.disk?.write_mbs||0).toFixed(2)}`;
      document.getElementById("gcpLogs").innerText = `${t.errors_5m || 0}`;
      document.getElementById("gcpRequests").innerText = `${t.requests || 0}`;
      document.getElementById("gcpLatency").innerText = `${t.latency_ms || 0} ms`;
    });
}

/* ---- Floating chat ---- */
document.getElementById("chatBubble").onclick=()=>{ 
  const w=document.getElementById("chatWindow"); 
  w.style.display=(w.style.display==="flex") ? "none":"flex"; 
};

async function sendMessage(){ 
  const input=document.getElementById("userInput"); 
  const msg=input.value.trim(); 
  if(!msg) return; 

  const box=document.getElementById("chatBox"); 
  box.innerHTML += `<div class="user-msg">${msg}</div>`; 
  input.value=""; 
  box.scrollTop = box.scrollHeight;

  try {
    const res = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: msg })
    });
    const data = await res.json();
    if (data.response) {
      box.innerHTML += `<div class="bot-msg">${data.response}</div>`;
    } else if (data.error) {
      box.innerHTML += `<div class="bot-msg">‚ö†Ô∏è ${data.error}</div>`;
    } else {
      box.innerHTML += `<div class="bot-msg">(no reply)</div>`;
    }
  } catch(err){
    box.innerHTML += `<div class="bot-msg">‚ö†Ô∏è Chat error: ${err.message}</div>`;
  }

  box.scrollTop = box.scrollHeight;
}

</script>
